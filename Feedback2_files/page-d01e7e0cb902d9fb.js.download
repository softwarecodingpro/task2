(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5261],{13888:function(e,t,n){Promise.resolve().then(n.bind(n,66123))},66123:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return A}});var a=n(57437),i=n(69700),r=n(34118),s=n(60727),o=n(24033),l=n(17311),c=n(28243),d=n(10513),u=n(2265),m=n(63193),f=n(28535),p=n(39959);function DiscardDraftModal(e){let{isOpen:t,onClose:n,onDiscard:i}=e,r=(0,u.useRef)(null);return(0,a.jsx)(f.u.Root,{show:t,as:u.Fragment,children:(0,a.jsx)(p.Vq,{as:"div",className:"fixed z-50 inset-0 overflow-y-auto",initialFocus:r,onClose:n,children:(0,a.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,a.jsx)(f.u.Child,{as:u.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,a.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),(0,a.jsx)(f.u.Child,{as:u.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,a.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full sm:p-6",children:[(0,a.jsx)(p.Vq.Title,{as:"h3",className:"text-lg font-medium text-gray-900",children:"Discard conversation?"}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"This will permanently discard your in-progress conversation. This cannot be undone."})}),(0,a.jsxs)("div",{className:"mt-5 sm:mt-4 flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",ref:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:n,children:"Cancel"}),(0,a.jsx)("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700",onClick:i,children:"Discard"})]})]})})]})})})}function DraftWarningBanner(e){let{modelMismatch:t,onDiscard:n}=e,[i,r]=(0,u.useState)(!1);return t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"bg-yellow-50 border-b border-yellow-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(m.Z,{icon:"ExclamationTriangleIcon",className:"h-5 w-5 text-yellow-400 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm text-yellow-800",children:"This conversation was started with models that are no longer available. You can submit your feedback, but new messages cannot be sent."})]}),(0,a.jsx)("button",{onClick:()=>r(!0),className:"ml-4 px-3 py-1 text-sm font-medium text-yellow-800 bg-yellow-100 hover:bg-yellow-200 rounded-md transition-colors whitespace-nowrap",children:"Discard conversation"})]})})}),(0,a.jsx)(DiscardDraftModal,{isOpen:i,onClose:()=>r(!1),onDiscard:()=>{r(!1),n()}})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"bg-blue-50 border-b border-blue-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-blue-800",children:"Restored from a previous session."}),(0,a.jsx)("button",{onClick:()=>r(!0),className:"ml-4 px-3 py-1 text-sm font-medium text-blue-800 bg-blue-100 hover:bg-blue-200 rounded-md transition-colors",children:"Discard"})]})})}),(0,a.jsx)(DiscardDraftModal,{isOpen:i,onClose:()=>r(!1),onDiscard:()=>{r(!1),n()}})]})}var v=n(81653),g=n(20023),h=n.n(g),y=n(96211),x=n(21);let j=(0,u.createContext)(void 0),useAsyncTasks=()=>{let e=(0,u.useContext)(j);if(!e)throw Error("useAsyncTasks must be used within an AsyncTasksProvider");return e};function AsyncTasksProvider(e){let{children:t}=e,[n,r]=(0,u.useState)([]),[s,o]=(0,u.useState)(!1),l=(0,u.useRef)(null),c=(0,i.D3)(),d=(0,u.useCallback)(async e=>{try{o(!0),"default"===Notification.permission&&Notification.requestPermission();let t=await y.ZP.getAsyncConversations(c,"","started",e),n=await y.ZP.getAsyncConversations(c,"","completed",e),a=[...n.conversations,...t.conversations];if(l.current){let e=new Set(t.conversations.map(e=>e.conversationUuid)),n=l.current.filter(t=>!e.has(t.conversationUuid));n.forEach(e=>{let t=e.summary||e.conversationUuid;if("granted"===Notification.permission){let n=new Notification("Task completed: ".concat(t),{body:"Click to view task"});n.onclick=()=>{window.focus(),window.location.href="/conversation/".concat(e.conversationUuid)}}})}return l.current=t.conversations,r(a),a.length}catch(e){return e instanceof Error&&"AbortError"!==e.name&&x.Tb(e),0}finally{o(!1)}},[c]);(0,u.useEffect)(()=>{let e;if(!(null==c?void 0:c.isAuthenticated))return;let t=new AbortController,pollForTasks=async()=>{let n=await d(t);n>0&&(e=window.setTimeout(pollForTasks,15e3))};return pollForTasks(),()=>{t.abort(),e&&window.clearTimeout(e)}},[null==c?void 0:c.isAuthenticated,d]);let m=(0,u.useMemo)(()=>({tasks:n,loading:s,refreshTasks:d}),[n,s,d]);return(0,a.jsx)(j.Provider,{value:m,children:t})}var w=n(82148),b=n(57042),S=n(51002);function FloatingTaskList(){let{tasks:e,loading:t,refreshTasks:n}=useAsyncTasks(),[i,r]=(0,u.useState)(!1),s=(0,o.useRouter)();return 0!==e.length||t?(0,a.jsxs)("div",{className:"fixed bottom-4 right-4",children:[(0,a.jsxs)("button",{onClick:()=>r(!i),className:"flex  space-x-2 rounded-full bg-blue-600 text-white px-4 py-2 shadow-lg hover:bg-blue-700 transition-all",children:[(0,a.jsx)("span",{className:"font-medium",children:"Async Tasks"}),(0,a.jsx)("span",{className:"bg-white text-blue-600 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold",children:t?"...":e.length})]}),i&&(0,a.jsxs)("div",{className:"absolute bottom-14 right-0 w-96 bg-white rounded-lg shadow-xl border border-gray-200 max-h-96 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"p-3 border-b flex justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-700",children:"Running Tasks"}),(0,a.jsxs)("div",{className:"flex  space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{n()},className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:t,title:"Refresh tasks",children:(0,a.jsx)(m.Z,{icon:"ArrowPathIcon",className:"w-5 h-5 ".concat(t?"animate-spin":"")})}),(0,a.jsx)("button",{"data-testid":"close-button",onClick:()=>r(!1),className:"text-gray-400 hover:text-gray-600 ml-2",children:(0,a.jsx)(m.Z,{icon:"XMarkIcon",className:"w-5 h-5"})})]})]}),(0,a.jsx)("div",{className:"divide-y",children:e.map(e=>(0,a.jsx)("div",{className:"p-3 hover:bg-gray-50 cursor-pointer",onClick:()=>{"completed"===e.status&&(r(!1),s.push("/conversation/".concat(e.conversationUuid)))},children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1 truncate",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-800 truncate",children:e.summary||e.conversationUuid}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Interface: "}),(0,a.jsx)("span",{children:e.interface})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Started: "}),(0,a.jsx)("span",{children:S.ou.fromISO(e.createdAt).toRelative()})]})]}),(0,a.jsx)("div",{className:(0,b.Z)("ml-2 text-xs px-2 py-1 rounded-full border",w.Z[e.status]),children:w.u[e.status]})]})},e.conversationUuid))})]})]}):null}var C=n(50992),N=n(43667),P=n(94152),k=n(38038),_=n(23588),_interfaceSlug_LiveInterfaceDCP=function(e){var t;let{interfaceSlug:s}=e,l=new URLSearchParams(n.g.window&&window.location.search),m=l.get("key"),f=l.get("workerId"),{startNewConversation:p,setConversation:g,conversation:x}=(0,c.Z)(),[j,w]=(0,u.useState)(!1),b=(0,i.D3)(),S=m?null:b,T=f||null,D=(0,o.useParams)(),F=!m&&b.isAuthenticated,{draft:I,isLoading:A,saveDraft:R,clearDraft:q}=function(e,t){let{data:n,isLoading:a}=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=(0,i.D3)(),queryFn=async()=>{try{var t,a,i;let r=await (0,y.nv)({auth0:n,path:"/conversation-drafts",queryParams:{interface_slug:e}});if(!r.draft)return null;return{conversation:JSON.parse(r.draft.conversation),resolvedProjectSnapshot:JSON.parse(r.draft.resolved_project_snapshot),updatedAt:r.draft.updated_at,sessionId:null!==(t=r.draft.session_id)&&void 0!==t?t:void 0,compactionSummary:null!==(a=r.draft.compaction_summary)&&void 0!==a?a:void 0,compactionSummaryTag:null!==(i=r.draft.compaction_summary_tag)&&void 0!==i?i:void 0}}catch(e){if(e instanceof y.MS&&404===e.code)return null;throw e}};return(0,P.a)({queryKey:["conversationDrafts",e],queryFn,enabled:n.isAuthenticated&&t&&!!e,staleTime:0,gcTime:0})}(e,t),{mutate:r}=function(e){let t=(0,i.D3)(),n=(0,k.NL)();return(0,_.D)({mutationFn:async e=>{var n,a,i;let r=e.conversation.uuid,s={conversation:JSON.stringify(e.conversation),resolved_project_snapshot:JSON.stringify(e.resolvedProjectSnapshot),interface_slug:e.interfaceSlug,session_id:null!==(n=e.sessionId)&&void 0!==n?n:null,compaction_summary:null!==(a=e.compactionSummary)&&void 0!==a?a:null,compaction_summary_tag:null!==(i=e.compactionSummaryTag)&&void 0!==i?i:null};await (0,y.nv)({auth0:t,path:"/conversation-drafts/".concat(encodeURIComponent(r)),options:{method:"PUT",body:JSON.stringify(s)}})},onSuccess:()=>{n.invalidateQueries({queryKey:["conversationDrafts",e]})}})}(e),{mutateAsync:s}=function(e){let t=(0,i.D3)(),n=(0,k.NL)();return(0,_.D)({mutationFn:async e=>{try{await (0,y.nv)({auth0:t,path:"/conversation-drafts/".concat(encodeURIComponent(e)),options:{method:"DELETE"}})}catch(e){if(e instanceof y.MS&&404===e.code)return;throw e}},onSuccess:()=>{n.invalidateQueries({queryKey:["conversationDrafts",e]})}})}(e),o=(0,u.useCallback)((t,n,a)=>{r({conversation:t,resolvedProjectSnapshot:n,interfaceSlug:e,...a})},[r,e]),l=(0,u.useCallback)(async e=>{await s(e)},[s]);return{draft:null!=n?n:null,isLoading:a,saveDraft:o,clearDraft:l}}(s,F),[E,L]=(0,u.useState)(!1),[M,O]=(0,u.useState)(!1),[U,Z]=(0,u.useState)(""),[z,J]=(0,u.useState)(""),[K,B]=(0,u.useState)(),[Q,V]=(0,u.useState)(),[W,Y]=(0,u.useState)();function resetRestoredState(){L(!1),O(!1),Z(""),J(""),B(void 0),V(void 0),Y(void 0)}let{data:H,isLoading:X,error:G}=(0,C.xP)(s,!m&&b.isAuthenticated),$=(0,u.useMemo)(()=>H?H.filter(e=>e.live):[],[H]),[ee,et]=(0,u.useState)(null),{data:en,isLoading:ea,error:ei,refetch:er}=(0,C.HM)(null!==(t=null==ee?void 0:ee.id)&&void 0!==t?t:"",s,!!ee&&(!!m||b.isAuthenticated)),es=(0,u.useCallback)(()=>en?(0,N.c)(en,!0):null,[en]),[eo,el]=(0,u.useState)(null),[ec,ed]=(0,u.useState)(en);function startFreshConversation(e){var t;let n=es();n&&(el(n),ed(en),h().initialize({currentPageName:"conversation",idleTimeoutInSeconds:30}),h().resetRecordedPageTime("conversation"),h().startTimer("conversation"),p(n,T||(null==S?void 0:null===(t=S.user)||void 0===t?void 0:t.email)||"",null,{preserveModelAssignments:null==e?void 0:e.preserveModelAssignments}),resetRestoredState(),w(!0))}(0,v.t)({interface:(null==eo?void 0:eo.interfaceSlug)||s,experiment:null==eo?void 0:eo.projectId}),(0,u.useEffect)(()=>{if(X||ee||0===$.length||F&&A)return;if(I){let e=I.conversation.experimentId,t=$.find(t=>t.id===e);if(t){et(t);return}}let e=Math.floor(Math.random()*$.length);et($[e])},[X,$,ee,I,F,A]),(0,u.useEffect)(()=>{var e;if(j||!ee||!en||ea||!m&&!S||F&&A)return;let t=null==D?void 0:null===(e=D.interfaceSlug)||void 0===e?void 0:e[0];t&&s!==t||function(){let e=sessionStorage.getItem("pendingCompaction");if(e){sessionStorage.removeItem("pendingCompaction");let t=JSON.parse(e);startFreshConversation(),B(t.summary),V(t.summaryTag),Y(t.parentConversationUuid),t.preservedSessionId&&J(t.preservedSessionId);return}if(I&&I.conversation.experimentId===(null==ee?void 0:ee.id)){(function(){var e,t,n,a;if(!I||!ee)return;let i=(0,N.c)(I.resolvedProjectSnapshot,!1);el(i),ed(I.resolvedProjectSnapshot);let r=[I.resolvedProjectSnapshot.samplingConfigA.modelName,I.resolvedProjectSnapshot.samplingConfigB.modelName],s=new Set(ee.samplingConfigs.map(e=>e.modelName)),o=r.some(e=>!s.has(e));O(o);let l=new Date(Date.now()-1e3*I.conversation.elapsedTime);h().initialize({currentPageName:"conversation",idleTimeoutInSeconds:30,initialStartTime:l}),h().resetRecordedPageTime("conversation"),h().startTimer("conversation",l);let c=[...I.conversation.steps],d=c.length>0?c[c.length-1]:null,u="";(null==d?void 0:d.speaker)==="human"&&(u=null!==(n=null===(t=d.choices)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.text)&&void 0!==n?n:"",c.pop()),g({...I.conversation,steps:c}),Z(u),J(null!==(a=I.sessionId)&&void 0!==a?a:""),B(I.compactionSummary),V(I.compactionSummaryTag),L(!0),w(!0)})();return}startFreshConversation()}()},[ee,en,m,S,null==D?void 0:D.interfaceSlug,j,ea,F,A]);let eu=(0,u.useCallback)(()=>{U&&Z(""),F&&x&&ec&&(null!=eo&&eo.isAsync||R(x,ec,{sessionId:z||void 0,compactionSummary:K,compactionSummaryTag:Q}))},[F,x,ec,R,U,null==eo?void 0:eo.isAsync,z,K,Q]),em=(0,u.useCallback)((e,t)=>{F&&ec&&(null!=eo&&eo.isAsync||R(e,ec,t))},[F,ec,R,null==eo?void 0:eo.isAsync]);async function getNewConversation(e){var t;let n;if(F&&(null==x?void 0:x.uuid)&&await q(x.uuid),(null==e?void 0:e.preserveModels)&&eo&&ec)n={...n=(0,N.c)(ec,!1),modelsBySpeaker:eo.modelsBySpeaker};else{let{data:e}=await er();if(!e)return;n=(0,N.c)(e,!0),ed(e)}el(n),h().resetRecordedPageTime("conversation"),h().startTimer("conversation"),p(n,T||(null==S?void 0:null===(t=S.user)||void 0===t?void 0:t.email)||"",null,{preserveModelAssignments:null==e?void 0:e.preserveModels}),resetRestoredState()}async function handleDiscardDraft(){(null==x?void 0:x.uuid)&&await q(x.uuid),await getNewConversation()}return G||ei?(0,a.jsxs)("div",{className:"min-h-screen grid content-center max-w-md m-auto",children:[(0,a.jsx)("h1",{className:"text-4xl text-gray-300 font-medium uppercase tracking-wider",children:"Error Loading Interface"}),(0,a.jsx)("p",{className:"my-5 text-gray-700",children:"Failed to load the Data Collection Project for this interface. Please try again later."})]}):X||0!==$.length?(null==eo?void 0:eo.blockFromWeb)===!0?(0,a.jsxs)("div",{className:"min-h-screen grid content-center max-w-md m-auto",children:[(0,a.jsx)("h1",{className:"text-4xl text-gray-300 font-medium uppercase tracking-wider",children:"Interface Not Available"}),(0,a.jsx)("p",{className:"my-5 text-gray-700",children:"This interface cannot be accessed directly through the web interface."})]}):j&&eo?(0,a.jsxs)(a.Fragment,{children:[E&&(0,a.jsx)(DraftWarningBanner,{modelMismatch:M,onDiscard:handleDiscardDraft}),(0,a.jsx)(d.Z,{projectParams:eo,getNewConversation:getNewConversation,populatedFromCache:E,preloadedPrompt:null,sessionId:z,initialSpeaker:"human",readOnly:M,onBeforeSample:F?eu:void 0,onAfterChoice:F?em:void 0,draftMessage:U,initialCompactionSummary:K,initialCompactionSummaryTag:Q,initialCompactedFromUuid:W,onCompactionComplete:async()=>{await getNewConversation({preserveModels:!0})}}),(0,a.jsx)(AsyncTasksProvider,{children:(0,a.jsx)(FloatingTaskList,{})})]}):(0,a.jsx)(r.Z,{}):(0,a.jsxs)("div",{className:"min-h-screen grid content-center max-w-md m-auto",children:[(0,a.jsx)("h1",{className:"text-4xl text-gray-300 font-medium uppercase tracking-wider",children:"Interface Not Configured"}),(0,a.jsx)("p",{className:"my-5 text-gray-700",children:"No active Data Collection Project found for this interface. Please contact an administrator."})]})},T=n(76672),D=n(74557),_interfaceSlug_LiveInterfaceLegacy=function(e){let{interfaceSlug:t}=e,l=new URLSearchParams(n.g.window&&window.location.search),m=l.get("key"),f=l.get("experimentId"),p=l.get("workerId"),{loadConversationFromSessionStorage:g,startNewConversation:j}=(0,c.Z)(),[w,b]=(0,u.useState)([]),[S,C]=(0,u.useState)(null),[P,k]=(0,u.useState)(""),_=(0,s.Z)(),[F,I]=(0,u.useState)(null),A=(0,i.D3)(),R=m?null:A,q=p||null,E=(0,o.useRouter)(),L=(0,o.useParams)(),M=(0,o.useSearchParams)(),{openSnackbar:O}=(0,T.Z)(),U=(0,u.useMemo)(()=>_&&S?(0,N.g)(_,S):null,[_,S]),Z="".concat(_.slug,"-currentExperiment");async function initializeState(){let e=await loadExperiments(),t=sessionStorage.getItem(Z),n=t?JSON.parse(t):null,a=(0,D.iD)(null==n?void 0:n.id),i=n&&sessionStorage.getItem(a),r=i?JSON.parse(i):null,s=n&&sessionStorage.getItem((0,D.mN)(null==n?void 0:n.id)),o=e.find(e=>e.id===(null==n?void 0:n.id));if(o&&JSON.stringify(o)===JSON.stringify(n)&&r&&(null==r?void 0:r.experimentId)===(null==n?void 0:n.id)&&!n.isAsync){let t=g(a);b(e.filter(e=>e.id!==n.id)),C(n),k(s||""),I(!0);let i=new Date(Date.now()-1e3*t.elapsedTime);h().initialize({currentPageName:"conversation",idleTimeoutInSeconds:30,initialStartTime:i}),h().resetRecordedPageTime("conversation"),h().startTimer("conversation",i)}else await getNewConversation()}(0,v.t)({interface:(null==U?void 0:U.interfaceSlug)||_.slug,experiment:null==U?void 0:U.projectId}),(0,u.useEffect)(()=>{var e;if(null!==F||!m&&!R||!(null==_?void 0:_.slug))return;let t=null==L?void 0:null===(e=L.interfaceSlug)||void 0===e?void 0:e[0];t&&(null==_?void 0:_.slug)!==t||initializeState()},[_.slug,m,R,null==L?void 0:L.interfaceSlug]);let loadExperiments=async()=>{var e;if(M.get("code"))return[];let t=(null==R?void 0:null===(e=R.user)||void 0===e?void 0:e.email)||q||void 0,n=f?{interface:_.slug,experiment_id:f}:{interface:_.slug,human_id:t};try{let e=await y.ZP.experiments(m,R,n,E);return 0===e.length&&x.Tb("got 0 experiments",{extra:n}),function(e){if(!e)return[];if(1===e.length)return e;let t=[];for(let n=0;n<e.length;n++)for(let a=1;a<=e[n].priority;a++)t.push(e[n]);return(0,D.TV)(t)}(e)}catch(e){return x.Tb(e),[]}};async function getNewConversation(){var e;let t=await loadExperiments();if(0===t.length){O("No experiments loaded; Please refresh the page and try again. If this problem persists, please let us know.","error");return}let n=new Set(t.map(e=>e.id)),a=w;0===(a=a.filter(e=>n.has(e.id))).length&&(a=t);let i=a[a.length-1];C(i),b(a.slice(0,-1)),sessionStorage.setItem(Z,JSON.stringify(i));let r=(0,N.g)(_,i);j(r,q||(null==R?void 0:null===(e=R.user)||void 0===e?void 0:e.email)||""),I(!1)}return!0===_.blockFromWeb?(0,a.jsxs)("div",{className:"min-h-screen grid content-center max-w-md m-auto",children:[(0,a.jsx)("h1",{className:"text-4xl text-gray-300 font-medium uppercase tracking-wider",children:"Interface Not Available"}),(0,a.jsx)("p",{className:"my-5 text-gray-700",children:"This interface cannot be accessed directly through the web interface."})]}):null!==F&&U?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{projectParams:U,getNewConversation:getNewConversation,populatedFromCache:F,preloadedPrompt:null,sessionId:P,initialSpeaker:"human"}),(0,a.jsx)(AsyncTasksProvider,{children:(0,a.jsx)(FloatingTaskList,{})})]}):(0,a.jsx)(r.Z,{})};function LiveInterface(){var e;let t=new URLSearchParams(n.g.window&&window.location.search),c=t.get("key"),d=t.get("error"),u=(0,i.D3)(),m=(0,o.useRouter)(),f=(0,o.useParams)(),p=(0,s.Z)();d&&m.push("/404");let v=(null==f?void 0:null===(e=f.interfaceSlug)||void 0===e?void 0:e[0])||p.slug,g=(0,l.F)(v);return!c&&u.isLoading?(0,a.jsx)(r.Z,{}):g?(0,a.jsx)(_interfaceSlug_LiveInterfaceDCP,{interfaceSlug:v}):(0,a.jsx)(_interfaceSlug_LiveInterfaceLegacy,{interfaceSlug:v})}let F=new URLSearchParams(n.g.window&&window.location.search),I=F.get("key")||F.get("error")?LiveInterface:(0,i.u3)(LiveInterface,{onRedirecting:()=>(0,a.jsx)(r.Z,{})});var A=I},81653:function(e,t,n){"use strict";n.d(t,{Z:function(){return SentryEnrich},t:function(){return useSentryEnrich}});var a=n(69700),i=n(2265),r=n(21);function SentryEnrich(){let e=(0,a.D3)();return(0,i.useEffect)(()=>{var t,n,a,i;if(e&&e.isAuthenticated)return r.av({id:null===(t=e.user)||void 0===t?void 0:t.sub,email:null===(n=e.user)||void 0===n?void 0:n.email,username:(null===(a=e.user)||void 0===a?void 0:a.name)||(null===(i=e.user)||void 0===i?void 0:i.nickname)}),()=>{r.av(null)}},[e]),null}function useSentryEnrich(e){let[t,n]=(0,i.useState)(()=>JSON.stringify(e));(0,i.useEffect)(()=>{n(JSON.stringify(e))},[e]),(0,i.useEffect)(()=>{let e=JSON.parse(t);for(let[t,n]of Object.entries(e))n&&r.YA(t,n);return()=>{for(let t of Object.keys(e))r.YA(t,void 0)}},[t])}},50992:function(e,t,n){"use strict";n.d(t,{BK:function(){return useDataCollectionProject},HM:function(){return useResolvedProject},Pm:function(){return useDataCollectionProjects},XJ:function(){return useCreateDataCollectionProject},vh:function(){return useBulkUpdateDataCollectionProjects},wt:function(){return useUpdateDataCollectionProject},xP:function(){return useDataCollectionProjectsForInterface}});var a=n(94152),i=n(38038),r=n(23588),s=n(69700),o=n(21747),l=n.n(o),c=n(69504),d=n.n(c),u=n(96211);function appConfigFromSnakeCase(e){if(e){if("claude_code"===e.type){var t;return{type:"claude_code",envVars:null!==(t=e.env_vars)&&void 0!==t?t:{}}}if("hfi"===e.type)return{type:"hfi"}}}function projectAppConfigFromSnakeCase(e){if(null===e)return null;if(e){if("claude_code"===e.type)return{type:"claude_code"};if("hfi"===e.type){var t,n;return{type:"hfi",samplingMode:{type:null!==(n=null===(t=e.sampling_mode)||void 0===t?void 0:t.type)&&void 0!==n?n:"sync"}}}}}function serializeProjectRequest(e){var t,n;let a=null===(t=e.samplingConfigs)||void 0===t?void 0:t.map(e=>e.appConfig),i=e.appConfig,{appConfig:r,...s}=e,o={...s,samplingConfigs:null===(n=e.samplingConfigs)||void 0===n?void 0:n.map(e=>{let{appConfig:t,...n}=e;return n})},l=d()(o,{deep:!0}),c=l.sampling_configs;c&&a&&c.forEach((e,t)=>{let n=function(e){if(e){if("claude_code"===e.type)return{type:"claude_code",env_vars:e.envVars};if("hfi"===e.type)return{type:"hfi"}}}(a[t]);n&&(e.app_config=n)});let u=function(e){if(null===e)return null;if(e){if("claude_code"===e.type)return{type:"claude_code"};if("hfi"===e.type)return{type:"hfi",sampling_mode:{type:e.samplingMode.type}}}}(i);return void 0!==u&&(l.app_config=u),JSON.stringify(l)}function deserializeProjectResponse(e){var t;let n=null!==(t=e.sampling_configs)&&void 0!==t?t:[],a=n.map(e=>appConfigFromSnakeCase(e.app_config)),i=e.app_config,r=l()(e,{deep:!0});r.samplingConfigs.forEach((e,t)=>{e.appConfig=a[t]});let s=projectAppConfigFromSnakeCase(i);return void 0!==s&&(r.appConfig=s),r}function useDataCollectionProjects(e){let t=(0,s.D3)(),queryFn=async()=>{var n;let a={};void 0!==e&&(a.live=String(e));let i=await (0,u.nv)({auth0:t,path:"/admin/data-collection-projects",queryParams:d()(a,{deep:!0})}),r=null!==(n=i.projects)&&void 0!==n?n:[];return r.map(deserializeProjectResponse)};return(0,a.a)({queryKey:["dataCollectionProjects",{live:e}],queryFn,enabled:t.isAuthenticated,staleTime:6e4})}function useDataCollectionProject(e){let t=(0,s.D3)(),queryFn=async()=>{let n=await (0,u.nv)({auth0:t,path:"/admin/data-collection-projects/".concat(e)});return deserializeProjectResponse(n)};return(0,a.a)({queryKey:["dataCollectionProjects","project",e],queryFn,enabled:t.isAuthenticated&&!!e,staleTime:3e4})}function useCreateDataCollectionProject(){let e=(0,s.D3)(),t=(0,i.NL)();return(0,r.D)({mutationFn:async t=>{let n=await (0,u.nv)({auth0:e,path:"/admin/data-collection-projects",options:{method:"POST",body:serializeProjectRequest(t)}});return deserializeProjectResponse(n)},onSuccess:()=>{t.invalidateQueries({queryKey:["dataCollectionProjects"]})}})}function useUpdateDataCollectionProject(e){let t=(0,s.D3)(),n=(0,i.NL)();return(0,r.D)({mutationFn:async n=>{let a=await (0,u.nv)({auth0:t,path:"/admin/data-collection-projects/".concat(e),options:{method:"PUT",body:serializeProjectRequest(n)}});return deserializeProjectResponse(a)},onSuccess:()=>{n.invalidateQueries({queryKey:["dataCollectionProjects"]}),n.invalidateQueries({queryKey:["dataCollectionProjects","project",e]})}})}function useDataCollectionProjectsForInterface(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=(0,s.D3)(),queryFn=async()=>{var t;let a=await (0,u.nv)({auth0:n,path:"/data-collection-projects",queryParams:{interface:e}}),i=null!==(t=a.projects)&&void 0!==t?t:[];return i.map(deserializeProjectResponse)};return(0,a.a)({queryKey:["dataCollectionProjects","interface",e],queryFn,enabled:n.isAuthenticated&&t&&!!e,staleTime:6e4})}function useBulkUpdateDataCollectionProjects(){let e=(0,s.D3)(),t=(0,i.NL)();return(0,r.D)({mutationFn:async t=>{let n=[],a=[];for(let{projectId:i,data:r}of t)try{await (0,u.nv)({auth0:e,path:"/admin/data-collection-projects/".concat(i),options:{method:"PUT",body:serializeProjectRequest(r)}}),n.push(i)}catch(e){a.push({projectId:i,error:e instanceof Error?e.message:"Unknown error"})}return{succeeded:n,failed:a}},onSuccess:()=>{t.invalidateQueries({queryKey:["dataCollectionProjects"]})}})}function useResolvedProject(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=(0,s.D3)(),queryFn=async()=>{let n=await (0,u.nv)({auth0:i,path:"/data-collection-projects/".concat(e,"/resolve"),queryParams:{interface:t}});return function(e){let t=e.sampling_config_a,n=e.sampling_config_b,a=appConfigFromSnakeCase(null==t?void 0:t.app_config),i=appConfigFromSnakeCase(null==n?void 0:n.app_config),r=e.app_config,s=l()(e,{deep:!0});a&&(s.samplingConfigA.appConfig=a),i&&(s.samplingConfigB.appConfig=i);let o=projectAppConfigFromSnakeCase(r);return void 0!==o&&(s.appConfig=o),s}(n)};return(0,a.a)({queryKey:["resolvedProject",e,t],queryFn,enabled:i.isAuthenticated&&n&&!!e&&!!t,staleTime:0,gcTime:0})}},82148:function(e,t,n){"use strict";n.d(t,{Z:function(){return a},u:function(){return i}});let a={started:"bg-yellow-50 text-yellow-700 border-yellow-200",completed:"bg-green-50 text-green-700 border-green-200",failed:"bg-red-50 text-red-700 border-red-200"},i={failed:"failed",started:"running",completed:"ready for review"}},17311:function(e,t,n){"use strict";n.d(t,{F:function(){return isInterfaceMigrated}});let a=["artifacts","code_instruction_following_rubrics","computer_use_v2","law_office_tasks","office_tasks","office_tasks_skills","office_tasks_unified","philosophy_multiturn","pr_writer_v2_feedback","visual_design_v3"];function isInterfaceMigrated(e){return!a.includes(e)}}},function(e){e.O(0,[3954,5501,9982,7732,9700,9737,306,1396,4432,6619,1320,5089,6935,6944,724,3760,4959,8276,1667,4357,6698,3584,1975,49,3040,9519,2395,6211,6331,56,9936,9803,6245,2971,96,1744],function(){return e(e.s=13888)}),_N_E=e.O()}]);
//# sourceMappingURL=page-d01e7e0cb902d9fb.js.map